-- База данных уже создана через переменную окружения POSTGRES_DB
-- Таблица ролей
CREATE TABLE roles (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL
);

-- Таблица пользователей
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(100) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role_id INTEGER NOT NULL DEFAULT 2 REFERENCES roles(id) ON DELETE RESTRICT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Таблица разделов
CREATE TABLE sections (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Таблица контента (статьи, определения и т.д.)
CREATE TABLE content (
    id SERIAL PRIMARY KEY,
    section_id INTEGER NOT NULL REFERENCES sections(id) ON DELETE CASCADE,
    title VARCHAR(500) NOT NULL,
    content_text TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    author_id INTEGER REFERENCES users(id) ON DELETE SET NULL
);

-- Вставка начальных данных: роли
INSERT INTO roles (name) VALUES 
    ('admin'),
    ('user');

-- Вставка начальных данных: разделы
INSERT INTO sections (name, description) VALUES 
    ('Определения', 'Основные термины и определения в области информационной безопасности'),
    ('Лицензии', 'Информация о различных лицензиях в сфере информационной безопасности'),
    ('Стандарты', 'Международные и национальные стандарты информационной безопасности'),
    ('Угрозы', 'Классификация и описание угроз информационной безопасности'),
    ('Защита', 'Методы и средства защиты информации');

-- Вставка начальных данных: контент
INSERT INTO content (section_id, title, content_text, author_id) VALUES 
    (1, 'Информационная безопасность', 
     'Информационная безопасность (ИБ) — состояние защищенности информационной среды, обеспечивающее ее формирование, использование и развитие в интересах граждан, организаций, государства.', NULL),
    
    (1, 'Кибербезопасность', 
     'Кибербезопасность — практика защиты систем, сетей и программ от цифровых атак. Эти кибератаки обычно нацелены на получение доступа, изменение или уничтожение конфиденциальной информации.', NULL),
    
    (2, 'Лицензия ФСТЭК', 
     'Лицензия ФСТЭК России требуется для разработки, производства и распространения шифровальных (криптографических) средств, а также для оказания услуг по шифрованию информации.', NULL),
    
    (2, 'Лицензия ФСБ на деятельность по технической защите конфиденциальной информации', 
     'Лицензия ФСБ России необходима для оказания услуг по технической защите конфиденциальной информации, а также для разработки и производства средств защиты информации.', NULL),
    
    (3, 'ISO/IEC 27001', 
     'ISO/IEC 27001 — международный стандарт, который устанавливает требования к системе управления информационной безопасностью (СМИБ). Он помогает организациям управлять безопасностью активов.', NULL),
    
    (3, 'ГОСТ Р 57580.1-2017', 
     'Российский национальный стандарт, устанавливающий требования к защите информации при создании и эксплуатации автоматизированных систем в защищенном исполнении.', NULL),
    
    (4, 'Вредоносное программное обеспечение', 
     'Вредоносное ПО (malware) — программное обеспечение, предназначенное для получения несанкционированного доступа к вычислительным ресурсам или информации, хранящейся на компьютере.', NULL),
    
    (4, 'Социальная инженерия', 
     'Социальная инженерия — метод несанкционированного доступа к информации или системам путем манипулирования людьми, которые имеют доступ к этой информации.', NULL),
    
    (5, 'Шифрование', 
     'Шифрование — процесс преобразования информации с помощью алгоритмов шифрования, чтобы сделать ее недоступной для чтения без специального ключа.', NULL),
    
    (5, 'Антивирусное программное обеспечение', 
     'Антивирусное ПО — программа, предназначенная для обнаружения, предотвращения и удаления вредоносного программного обеспечения с компьютера.', NULL);

-- Создание администратора по умолчанию (пароль: admin123, хеш SHA256)
-- Пароль: admin123
-- SHA256 хеш: 240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9
INSERT INTO users (username, email, password_hash, role_id) VALUES 
    ('admin', 'admin@example.com', '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9', 1);

-- Индексы для оптимизации запросов
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_content_section_id ON content(section_id);
CREATE INDEX idx_content_title ON content(title);

